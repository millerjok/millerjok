<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Flashcard App</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;  /* To handle container sizes properly */
}

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #c9d6ff, #e2e2e2);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .banner {
            background: #ffffff;
            width: 100%;
            padding: 15px;
            text-align: center;
            font-size: 1.5em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .kana-text {
            font-size: 1em; /* Shrink the font size */
            color: rgb(50, 135, 178); /* Change the color to grey */
            font-weight: bold
        }
        .romaji-text {
            font-size: 0.8em; /* Shrink the font size */
            color: rgb(241, 241, 241); /* Change the text color to grey */
        }
        .english-text {
            font-size: 1em; /* Shrink the font size */
            color: rgb(0, 0, 0); /* Change the color to grey */
        }
        .catalogue-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        .catalogue-button {
            padding: 12px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #4CAF50;
            /* Calming green color for focus */
            color: #fff;
            transition: background-color 0.3s;
            margin: 10px;
        }
        .catalogue-button:hover {
            background-color: #81c784;
        }
        

        .mode-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            padding: 30px;
            display: none;
        }
        .flashcard-container, .test-container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 600px;
            height: 700px;
            /* Enlarged for better focus */
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 40px;
            transition: transform 0.3s;
    
        }
        .flashcard-container:hover, .test-container:hover {
            transform: scale(1.05);
        }
        .flashcard, .test-question {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 10px;
            background: #f7f7f7;
            width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            color: #333;
        }
        .button-container, .test-answers {
            display: flex;
            justify-content: top;
            width: 100%;
            flex-wrap: wrap;
            flex-direction: column;
            align-items: top;
        }
        button {
            padding: 12px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #4c7daf;
            color: #fff;
            transition: background-color 0.3s;
            margin: 10px;
        }
        button:hover {
            background-color: #6e95bb;
        }
        #next-button {
            display: none;
        }
        .home-button {
            
    width: 50px;
    height: 50px;
    background: url('https://www.fivesenseseducation.com.au/media/catalog/product/cache/6784d9c84c6c2876bb0ec06c7a104398/9/7/9781488624063_iitomo_2_2e_activity_book.jpg') no-repeat center center;
    background-size: cover;
    border: none;
    cursor: pointer;
    position: absolute;
    top: 20px;
    left: 20px;
    transition: transform 0.2s;
}
.home-button:hover {
    transform: scale(1.1);
}
.listening-container {
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    width: 600px;
    padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: auto;
}

.speaker-button {
    width: 50px;
    height: 50px;
    background: url('https://cdn-icons-png.flaticon.com/512/727/727245.png') no-repeat center center;
    background-size: cover;
    border: none;
    cursor: pointer;
    margin: 20px 0;
    transition: transform 0.2s;
}

.speaker-button:hover {
    transform: scale(1.1);
}

.listening-answers {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
}

.listening-answers button {
    padding: 10px 20px;
    font-size: 1.1em;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #4CAF50;
    color: #fff;
    transition: background-color 0.3s;
}

.listening-answers button:hover {
    background-color: #0058bd;
}

.matching-container {
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    width: 600px;
    padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: auto;
}

.matching-game {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.matching-item {
    width: 150px;
    padding: 10px;
    background-color: #f7f7f7;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    text-align: center;
    user-select: none;
}

.matching-item.selected {
    background-color: #81c784; /* Change to a distinct color when selected */
    border: 2px solid #4caf50;  /* Add a green border to indicate selection */
}

.flashcard-container,
.test-container,
.matching-container,
.listening-container {
    display: none; /* Initially hidden */
}

.flashcard-container.show,
.test-container.show,
.matching-container.show,
.listening-container.show {
    display: flex; /* Make the container visible */
}

.battle-container {
    display: flex;
    flex-direction: column;  /* Stack everything vertically */
    align-items: center;  /* Center all elements horizontally */
    text-align: center;
    padding: 20px;
}

.stage {
    display: flex;
    justify-content: space-between;  /* Keep the boxers spaced evenly */
    align-items: center;             /* Align items vertically in the center */
    background: url('https://aipict.com/wp-content/uploads/2023/09/plain03-1024x683.png') no-repeat center center;
    background-size: cover;          /* Cover the stage area */
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 520px;                      /* Adjust the width to take up more space */
    height: 330px;
    max-width: 2000px;               /* Prevent the stage from becoming too large on big screens */
    margin: 20px auto;               /* Center horizontally */
    overflow: hidden;
}


.stage-hit {
        background-color: red !important;  /* Force the red color for visibility */
        transition: background-color 0.5s ease;  /* Smoothly transition back */
    }

.fighter-container {
    display: flex;
    flex-direction: column;  /* Stack elements inside each fighter container */
    align-items: center;  /* Center each fighter */
    width: 150px;  /* Adjust the width based on the size of the sprites */
}

.hp-bar {
    width: 100%;
    height: 15px;  /* Height of the HP bar for visibility */
    background: #ccc;  /* Light background for the HP bar */
    border-radius: 5px;
    margin-bottom: 10px;  /* Space between HP bar and the boxer */
    position: relative;
}

.hp {
    height: 100%;
    background: green;  /* Green bar for health */
    width: 100%;  /* Starts fully filled */
    transition: width 0.5s ease;  /* Smoothly decrease when hit */
    border-radius: 5px;
}

.battle-question {
    margin-top: 20px;
    font-size: 1.5em;  /* Larger font size for question text */
}

.battle-answers {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
    justify-content: center;  /* Center answer buttons */
}


.sprite-image {
    width: 150px;  /* Adjust the size to suit your sprite */
    height: auto;  /* Maintain the aspect ratio */
    position: relative;
}


@keyframes sprite-punch {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(-10px); } /* Simulate a punch motion */
}

.sprite-image.left {
    animation: sprite-punch 2s infinite;
}

.sprite-image.right {
    animation: sprite-punch 2s infinite;
}

#sprite-selection-container {
    width: 80%; /* Adjust as needed for desired width */
    height: 35%;
    margin: 0 auto; /* Center the container horizontally */
    padding: 20px; /* Add some padding for spacing */
    background-color: #f9f9f9; /* Optional: light background for contrast */
    border-radius: 10px; /* Optional: rounded corners for style */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Optional: add a subtle shadow */
}



    </style>


<script defer="" data-domain="purple-nanni-72.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script></head>

<body>
    <div class="banner" style="position: relative;">
        <button class="home-button" onclick="resetAllContainers()" title="Return to Home"></button>
        <h1 class="banner-title">Year 8-9 Japanese: iitomo 2</h1>        
    </div>

    <div class="catalogue-container" id="catalogue-container">
        <h2>Choose a set of flashcards to practice</h2>
        <button class="catalogue-button" onclick="chooseSet(1)">Hobbies</button>
        <button class="catalogue-button" onclick="chooseSet(2)">Food</button>
        <button class="catalogue-button" onclick="chooseSet(3)">Time & Hour</button>
        <button class="catalogue-button" onclick="chooseSet(4)">School</button>
        <button class="catalogue-button" onclick="chooseSet(5)">Not Ready</button>
        <button class="catalogue-button" onclick="chooseSet(6)">Not Ready</button>
    </div>

    <div class="mode-container" id="mode-container">
        <h2>Choose a mode to practice</h2>
        <button class="catalogue-button" onclick="startFlashcardMode()">Flashcard Mode</button>
        <button class="catalogue-button" onclick="startTestMode()">Test Mode</button>
        <button class="catalogue-button" onclick="startListeningMode()">Listening Mode</button>
        <button class="catalogue-button" onclick="startMatchingMode()">Matching Mode</button>
        <button class="catalogue-button" onclick="startBattleMode()">Battle Mode</button>

    </div>
    



    <div id="battle-container" class="battle-container" style="display: none;">
        <h2>Battle Mode</h2>
        <!-- BGM and other elements as in the original code -->
        <div class="stage">
            <!-- User Boxer and HP Container -->
            <div class="fighter-container">
                <div class="hp-bar">
                    <div class="hp" id="user-hp"></div>
                </div>
                <div class="boxer" id="user-boxer">
                    <img src="" alt="User Sprite" class="sprite-image"> <!-- src is set dynamically -->
                </div>
            </div>
    
            <!-- NPC Boxer and HP Container -->
            <div class="fighter-container">
                <div class="hp-bar">
                    <div class="hp" id="npc-hp"></div>
                </div>
                <div class="boxer" id="npc-boxer">
                    <img src="" alt="NPC Sprite" class="sprite-image"> <!-- src is set dynamically -->
                </div>
            </div>
        </div>
    
        <!-- Questions and answers go here -->
        <div id="battle-question" class="battle-question"></div>
        <div id="battle-answers" class="battle-answers"></div>
    </div>
    
    

        <audio id="battle-bgm" loop>
            <source src="pokebgm1.mp3" type="audio/mpeg">
            <source src="pokebgm2.mp3" type="audio/mpeg">
            <source src="pokebgm3.mp3" type="audio/mpeg">
        </audio>


        <audio id="pikachu-2-sound">
            <source src="pikachu-2-sound.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <audio id="tackle-sound">
            <source src="tackle-sound.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
        <audio id="victory-sound">
            <source src="victory-sound.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>



        <div id="sprite-selection-container" class="catalogue-container" style="display: none;">
            <h2>Select Your Pokémon</h2>
            <div id="available-sprites" class="battle-answers"></div>
        </div>

        

    
        <!-- Question Section below the stage -->
        <div id="battle-question" class="battle-question" style="margin-top: 20px; font-size: 1.5em;"></div>
        <div id="battle-answers" class="battle-answers" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
    </div>
    
    




    <div class="listening-container" id="listening-container" style="display: none;">
        <h2>Listening Mode</h2>
        <p>Click to hear the Japanese sentence, then choose the word being used in the sentence.</p>
        <button class="speaker-button" onclick="playListeningAudio()" aria-label="Play word"></button>
        <div class="listening-answers" id="listening-answers"></div>
    </div>

    <div class="flashcard-container" id="flashcard-container">
        <div id="flashcard" class="flashcard" onclick="playAudio()">Click "Show Meaning" to start!</div>
        <div class="button-container">
            <button id="show-meaning-button" onclick="showMeaning()">Show Meaning</button>
            <button id="study-again-button" style="display: none;" onclick="studyAgain()">Study Again</button>
            <button id="next-button" style="display: none;" onclick="nextFlashcard()">Next</button>
        </div>
        
    </div>

    <div class="test-container" id="test-container">
        <div id="test-question" class="test-question">Question will appear here</div>
        <div class="test-answers" id="test-answers"></div>
        
    </div>

    <div class="matching-container" id="matching-container" style="display: none;">
        <h2>Matching Mode</h2>
        <p>Match the Japanese word with its English meaning.</p>
        <div id="matching-game" class="matching-game"></div>
    </div>
    
    <audio id="card-flip-sound" src="card-flip-sound.mp3"></audio>
    <audio id="pikachu-sound" src="pikachu-sound.mp3"></audio>

    <script>
    let totalQuestions = 15;
    let currentQuestion = 0;
    let correctAnswers = 0;
    

    function startListeningMode() {
    document.getElementById('mode-container').style.display = 'none';
    document.getElementById('listening-container').style.display = 'flex';
    
    // Reset tracking variables
    currentQuestion = 0;
    correctAnswers = 0;

    loadListeningQuestion();
}


function loadListeningQuestion() {
    // Check if we've completed the total number of questions
    if (currentQuestion >= totalQuestions) {
        // Play Pikachu sound
        const pikachuSound = document.getElementById('pikachu-sound');
        pikachuSound.play();

        alert(`Listening Test complete! You got ${correctAnswers}/${totalQuestions} correct.`);
        goBackToCatalogue();
        return;
    }
    // Increment current question number
    currentQuestion++;

    // Select a random card from the current set
    const card = currentSet[Math.floor(Math.random() * currentSet.length)];
    const correctAnswer = card.english;

    // Generate three incorrect answers
    let answers = [correctAnswer];
    while (answers.length < 4) {
        const randomAnswer = currentSet[Math.floor(Math.random() * currentSet.length)].english;
        if (!answers.includes(randomAnswer)) {
            answers.push(randomAnswer);
        }
    }
    // Shuffle answers
    answers = answers.sort(() => Math.random() - 0.5);
    // Update the tally display in the question prompt
    const answersContainer = document.getElementById('listening-answers');
    const tallyContainer = document.createElement('p');
    tallyContainer.style.fontWeight = 'bold';
    tallyContainer.style.marginBottom = '10px';
    tallyContainer.textContent = `Question ${currentQuestion}/${totalQuestions}`;
    answersContainer.innerHTML = '';  // Clear previous content
    answersContainer.appendChild(tallyContainer);
    // Populate the answer buttons
    answers.forEach(answer => {
        const button = document.createElement('button');
        button.textContent = answer;
        button.onclick = () => checkListeningAnswer(answer, correctAnswer);
        answersContainer.appendChild(button);
    });
    // Store the current word for playback
    sessionStorage.setItem('currentListeningWord', JSON.stringify(card));
}


function playListeningAudio() {
    const card = JSON.parse(sessionStorage.getItem('currentListeningWord'));
    if (card) {
        const utterance = new SpeechSynthesisUtterance(card.example); // Play the "example" property
        utterance.lang = 'ja-JP';
        utterance.rate = 0.8; // Set reading speed to be slower (adjust value as needed)

        // Fetch available voices
        let voices = window.speechSynthesis.getVoices();

        // Wait until voices are loaded (sometimes they are not loaded immediately)
        if (voices.length === 0) {
            window.speechSynthesis.onvoiceschanged = () => {
                voices = window.speechSynthesis.getVoices();
                setJapaneseVoice(utterance, voices);
                window.speechSynthesis.speak(utterance);
            };
        } else {
            setJapaneseVoice(utterance, voices);
            window.speechSynthesis.speak(utterance);
        }
    }
}


function checkListeningAnswer(selectedAnswer, correctAnswer) {
    if (selectedAnswer === correctAnswer) {
        correctAnswers++;
        alert('Correct!');
    } else {
        alert('Incorrect. Try again!');
    }

    loadListeningQuestion(); // Load a new question
}


        const vocabularySets = {
            
            1: [
                { kanji: "私", kana: "わたし", romaji: "watashi", english: "I, me", example: "私は学生です。",  exampleEnglish: "I am a student." },
                { kanji: "行(い)きます", kana: "いきます", romaji: "ikimasu", english: "To go", example: "かいものに行きます。", exampleEnglish: "I go shopping." },
                { kanji: "します", kana: "します", romaji: "shimasu", english: "To do", example: "しゅくだいをします。",  exampleEnglish: "I do homework." },
                { kanji: "聞(き)きます", kana: "ききます", romaji: "kikimasu", english: "To listen", example: "おんがくを聞きます。",  exampleEnglish: "I listen to music." },
                { kanji: "読(よ)みます", kana: "よみます", romaji: "yomimasu", english: "To read", example: "まんがを読みます。", exampleEnglish: "I read a comic book." },
                { kanji: "見(み)ます", kana: "みます", romaji: "mimasu", english: "To see/watch", example: "えいがを見ます。",  exampleEnglish: "I watch a movie." },
                { kanji: "起(お)きます", kana: "おきます", romaji: "okimasu", english: "To wake up", example: "毎朝はやく起きます。",  exampleEnglish: "I wake up early every morning." },
                { kanji: "寝(ね)ます", kana: "ねます", romaji: "nemasu", english: "To sleep", example: "夜おそく寝ます。",  exampleEnglish: "I sleep late at night." },
                { kanji: "習(なら)います", kana: "ならいます", romaji: "naraimasu", english: "To learn", example: "日本語を習います。",  exampleEnglish: "I learn Japanese." },
                { kanji: "買(か)います", kana: "かいます", romaji: "kaimasu", english: "To buy", example: "本を買います。",  exampleEnglish: "I buy a book." },
                { kanji: "本", kana: "ほん", romaji: "hon", english: "Book", example: "本がきらいです。",  exampleEnglish: "I hate books." },
                { kanji: "水泳(すいえい)", kana: "すいえい", romaji: "suiei", english: "Swimming", example: "すいえいがすきです。",  exampleEnglish: "I like swimming." },
                { kanji: "公園(こうえん)", kana: "こうえん", romaji: "kouen", english: "Park", example: "こうえんでテニスをします。",  exampleEnglish: "I play tennis at the park." },
                { kanji: "ウォン先生(せんせい)", kana: "うぉんせんせい", romaji: "wonsensei", english: "Mr Wong", example: "ウォン先生は日本語をおしえます。",  exampleEnglish: "Mr Wong teaches Japanese." },
          
            ],

            2: [
                { kanji: "食べます", kana: "たべます", romaji: "tabemasu", english: "To eat", example: "ご飯を食べます。", exampleRomaji: "Gohan o tabemasu.", exampleEnglish: "I eat rice." },
                { kanji: "飲みます", kana: "のみます", romaji: "nomimasu", english: "To drink", example: "水を飲みます。", exampleRomaji: "Mizu o nomimasu.", exampleEnglish: "I drink water." },
                { kanji: "朝ごはん", kana: "あさごはん", romaji: "asagohan", english: "Breakfast", example: "朝ごはんを食べます。", exampleRomaji: "Asagohan o tabemasu.", exampleEnglish: "I eat breakfast." },
                { kanji: "昼ごはん", kana: "ひるごはん", romaji: "hirugohan", english: "Lunch", example: "昼ごはんを食べます。", exampleRomaji: "Hirugohan o tabemasu.", exampleEnglish: "I eat lunch." },
                { kanji: "晩ごはん", kana: "ばんごはん", romaji: "bangohan", english: "Dinner", example: "晩ごはんを食べます。", exampleRomaji: "Bangohan o tabemasu.", exampleEnglish: "I eat dinner." },
                { kanji: "パン", kana: "ぱん", romaji: "pan", english: "Bread", example: "パンを食べます。", exampleRomaji: "Pan o tabemasu.", exampleEnglish: "I eat bread." },
                { kanji: "卵(たまご)", kana: "たまご", romaji: "tamago", english: "Egg", example: "卵をりょうりします。", exampleRomaji: "Tamago o ryouri shimasu.", exampleEnglish: "I cook eggs." },
                { kanji: "肉", kana: "にく", romaji: "niku", english: "Meat", example: "肉が好きです。", exampleRomaji: "Niku ga suki desu.", exampleEnglish: "I like meat." },
                { kanji: "魚", kana: "さかな", romaji: "sakana", english: "Fish", example: "魚を食べます。", exampleRomaji: "Sakana o tabemasu.", exampleEnglish: "I eat fish." },
                { kanji: "野菜(やさい)", kana: "やさい", romaji: "yasai", english: "Vegetable", example: "野菜を食べます。", exampleRomaji: "Yasai o tabemasu.", exampleEnglish: "I eat vegetables." },
                { kanji: "果物(くだもの)", kana: "くだもの", romaji: "kudamono", english: "Fruit", example: "果物を食べます。", exampleRomaji: "Kudamono o tabemasu.", exampleEnglish: "I eat fruits." },
                { kanji: "水", kana: "みず", romaji: "mizu", english: "Water", example: "水を飲みます。", exampleRomaji: "Mizu o nomimasu.", exampleEnglish: "I drink water." },
                { kanji: "お茶(おちゃ)", kana: "おちゃ", romaji: "ocha", english: "Tea", example: "お茶を飲みます。", exampleRomaji: "Ocha o nomimasu.", exampleEnglish: "I drink tea." },
                { kanji: "牛乳(ぎゅうにゅう)", kana: "ぎゅうにゅう", romaji: "gyuunyuu", english: "Milk", example: "牛乳を飲みます。", exampleRomaji: "Gyuunyuu o nomimasu.", exampleEnglish: "I drink milk." },
                { kanji: "おいしい", kana: "おいしい", romaji: "oishii", english: "Delicious", example: "おべんとうはおいしいです。", exampleEnglish: "The bento is delicious." },
                { kanji: "食べ物", kana: "たべもの", romaji: "tabemono", english: "Food", example: "食べ物がたくさんあります。", exampleEnglish: "There is a lot of food." },

            ],

            3: [
            { kanji: "入ります", kana: "はいります", romaji: "hairimasu", english: "To enter", example: "おふろにはいります。", exampleEnglish: "I enter a bath." },
            { kanji: "あびます", kana: "あびます", romaji: "abimasu", english: "To shower", example: "シャワーをあびます。", exampleEnglish: "I take a shower." },
            { kanji: "帰(かえ)ります", kana: "かえります", romaji: "kaerimasu", english: "To return", example: "うちに帰ります。", exampleEnglish: "I return home." },
            { kanji: "毎日", kana: "まいにち", romaji: "mainichi", english: "Every day", example: "毎日ぶかつをします。", exampleEnglish: "Every day I do club activities." },
            { kanji: "何時", kana: "なんじ", romaji: "nanji", english: "What time", example: "今、何時ですか。", exampleEnglish: "What time is it now?" },
            { kanji: "半", kana: "はん", romaji: "han", english: "Half", example: "今、三時半です。", exampleEnglish: "Now, it is 3:30." },
            { kanji: "そして", kana: "そして", romaji: "soshite", english: "And then", example: "そして、くじにテレビを見ます。", exampleEnglish: "And then, I watch TV at 9:00." },
            { kanji: "土曜日", kana: "どようび", romaji: "doyoubi", english: "Saturday", example: "土曜日もぶかつをします。", exampleEnglish: "I also do club activities on Saturday." },
            { kanji: "木曜日", kana: "もくようび", romaji: "mokuyoubi", english: "Thursday", example: "木曜日にけんどうをします。", exampleEnglish: "I do Kendo on Thursday." },
            { kanji: "時", kana: "じ", romaji: "ji", english: "Time/hour", example: "じゅうじにねます。", exampleEnglish: "I sleep at 10:00." },
            { kanji: "好き", kana: "すき", romaji: "suki", english: "To like", example: "おんがくが好きです。", exampleEnglish: "I like music." },
            { kanji: "学校(がっこう)", kana: "がっこう", romaji: "gakkou", english: "School", example: "学校で勉強します。",  exampleEnglish: "I study at school." }
            ],

            4: [
            { kanji: "小学校", kana: "しょうがっこう", romaji: "shougakkou", english: "primary school", example: "小学校に行きます。", exampleEnglish: "I go to primary school." },
            { kanji: "中学校", kana: "ちゅうがっこう", romaji: "chuugakkou", english: "junior high school", example: "中学校で勉強します。", exampleEnglish: "I study at junior high school." },
            { kanji: "高校", kana: "こうこう", romaji: "koukou", english: "senior high school", example: "高校はとても楽しいです。", exampleEnglish: "Senior high school is very fun." },
            { kanji: "大学", kana: "だいがく", romaji: "daigaku", english: "university", example: "大学に入学しました。", exampleEnglish: "I entered university." },
            { kanji: "何年生", kana: "なんねんせい", romaji: "nan-nensei", english: "what grade", example: "あなたは何年生ですか。", exampleEnglish: "What grade are you in?" },
            { kanji: "小学生", kana: "しょうがくせい", romaji: "shougakusei", english: "primary school student", example: "私は小学生です。", exampleEnglish: "I am a primary school student." },
            { kanji: "中学生", kana: "ちゅうがくせい", romaji: "chuugakusei", english: "junior high school student", example: "妹は中学生です。", exampleEnglish: "My younger sister is a junior high school student." },
            { kanji: "高校生", kana: "こうこうせい", romaji: "koukousei", english: "senior high school student", example: "兄は高校生です。", exampleEnglish: "My older brother is a senior high school student." },
            { kanji: "かもく", kana: "かもく", romaji: "kamoku", english: "school subjects", example: "私の好きな科目は数学です。", exampleEnglish: "My favorite school subject is mathematics." },
            { kanji: "英語", kana: "えいご", romaji: "eigo", english: "English", example: "英語のクラスがあります。", exampleEnglish: "There is an English class." },
            { kanji: "国語", kana: "こくご", romaji: "kokugo", english: "national language", example: "国語を勉強します。", exampleEnglish: "I study the national language." },
            { kanji: "すう学", kana: "すうがく", romaji: "suugaku", english: "mathematics", example: "数学はむずかしいです。", exampleEnglish: "Mathematics is difficult." },
            { kanji: "音楽", kana: "おんがく", romaji: "ongaku", english: "music", example: "音楽のじゅぎょうが楽しいです。", exampleEnglish: "Music class is fun." },
            { kanji: "りか", kana: "りか", romaji: "rika", english: "science", example: "理科でじっけんをしました。", exampleEnglish: "We did an experiment in science." },
            { kanji: "びじゅつ", kana: "びじゅつ", romaji: "bijutsu", english: "art", example: "美術の宿題があります。", exampleEnglish: "I have art homework." },
            { kanji: "体いく", kana: "たいいく", romaji: "taiiku", english: "PE", example: "体育のじゅぎょうでサッカーをしました。", exampleEnglish: "We played soccer in PE class." },
            { kanji: "ぎじゅつ", kana: "ぎじゅつ", romaji: "gijutsu", english: "technology", example: "技術のクラスで木工をしました。", exampleEnglish: "We did woodworking in technology class." },
            { kanji: "社会", kana: "しゃかい", romaji: "shakai", english: "social sciences", example: "社会で歴史を学びます。", exampleEnglish: "We learn history in social sciences." },
            { kanji: "家ていか", kana: "かていか", romaji: "kateika", english: "home economics", example: "家庭科で料理を作りました。", exampleEnglish: "We cooked in home economics." },
            { kanji: "どうとく", kana: "どうとく", romaji: "doutoku", english: "ethics", example: "どうとくで正直について学びました。", exampleEnglish: "We learned about honesty in ethics." },
            { kanji: "ちょっと", kana: "ちょっと", romaji: "chotto", english: "a little", example: "ちょっと待ってください。", exampleEnglish: "Please wait a little." },
            { kanji: "時間目", kana: "じかんめ", romaji: "jikanme", english: "period", example: "一時間目は英語です。", exampleEnglish: "The first period is English." },
            { kanji: "何時間目", kana: "なんじかんめ", romaji: "nan jikanme", english: "which period", example: "何時間目にりかがありますか。", exampleEnglish: "In which period do you have science?" },
            { kanji: "昼休み", kana: "ひるやすみ", romaji: "hiruyasumi", english: "lunch break", example: "昼休みに友達とあそびます。", exampleEnglish: "I play with my friends during lunch break." },
            { kanji: "から", kana: "から", romaji: "kara", english: "from", example: "じゅぎょうはくじからです。", exampleEnglish: "Class starts from 9 o'clock." },
            { kanji: "まで", kana: "まで", romaji: "made", english: "to/until", example: "じゅぎょうは3時までです。", exampleEnglish: "Class is until 3 o'clock." },
            { kanji: "時間わり", kana: "じかんわり", romaji: "jikanwari", english: "timetable", example: "時間わりを見てください。", exampleEnglish: "Please look at the timetable." },
            { kanji: "そうじ", kana: "そうじ", romaji: "souji", english: "cleaning", example: "そうじをしました。", exampleEnglish: "I did cleaning." },




            ],            
            5: [
                { kanji: "本", kana: "ほん", romaji: "hon", english: "Book", example: "本を読みます。", exampleRomaji: "Hon o yomimasu.", exampleEnglish: "I read a book." },
                { kanji: "犬", kana: "いぬ", romaji: "inu", english: "Dog", example: "犬がいます。", exampleRomaji: "Inu ga imasu.", exampleEnglish: "There is a dog." },
                { kanji: "猫", kana: "ねこ", romaji: "neko", english: "Cat", example: "猫が好きです。", exampleRomaji: "Neko ga suki desu.", exampleEnglish: "I like cats." },
                { kanji: "家", kana: "いえ", romaji: "ie", english: "House", example: "家に帰ります。", exampleRomaji: "Ie ni kaerimasu.", exampleEnglish: "I return home." },
                { kanji: "食べる", kana: "たべる", romaji: "taberu", english: "To eat", example: "ご飯を食べます。", exampleRomaji: "Gohan o tabemasu.", exampleEnglish: "I eat a meal." },
                { kanji: "飲む", kana: "のむ", romaji: "nomu", english: "To drink", example: "水を飲みます。", exampleRomaji: "Mizu o nomimasu.", exampleEnglish: "I drink water." },
                { kanji: "行く", kana: "いく", romaji: "iku", english: "To go", example: "学校に行きます。", exampleRomaji: "Gakkou ni ikimasu.", exampleEnglish: "I go to school." },
                { kanji: "見る", kana: "みる", romaji: "miru", english: "To see", example: "映画を見ます。", exampleRomaji: "Eiga o mimasu.", exampleEnglish: "I watch a movie." },
                { kanji: "聞く", kana: "きく", romaji: "kiku", english: "To listen", example: "音楽を聞きます。", exampleRomaji: "Ongaku o kikimasu.", exampleEnglish: "I listen to music." },
                { kanji: "友人", kana: "ゆうじん", romaji: "yuujin", english: "Friend", example: "友人に会います。", exampleRomaji: "Yuujin ni aimasu.", exampleEnglish: "I meet my friend." }
            ],            
            6: [
                { kanji: "本", kana: "ほん", romaji: "hon", english: "Book", example: "本を読みます。", exampleRomaji: "Hon o yomimasu.", exampleEnglish: "I read a book." },
                { kanji: "犬", kana: "いぬ", romaji: "inu", english: "Dog", example: "犬がいます。", exampleRomaji: "Inu ga imasu.", exampleEnglish: "There is a dog." },
                { kanji: "猫", kana: "ねこ", romaji: "neko", english: "Cat", example: "猫が好きです。", exampleRomaji: "Neko ga suki desu.", exampleEnglish: "I like cats." },
                { kanji: "家", kana: "いえ", romaji: "ie", english: "House", example: "家に帰ります。", exampleRomaji: "Ie ni kaerimasu.", exampleEnglish: "I return home." },
                { kanji: "食べる", kana: "たべる", romaji: "taberu", english: "To eat", example: "ご飯を食べます。", exampleRomaji: "Gohan o tabemasu.", exampleEnglish: "I eat a meal." },
                { kanji: "飲む", kana: "のむ", romaji: "nomu", english: "To drink", example: "水を飲みます。", exampleRomaji: "Mizu o nomimasu.", exampleEnglish: "I drink water." },
                { kanji: "行く", kana: "いく", romaji: "iku", english: "To go", example: "学校に行きます。", exampleRomaji: "Gakkou ni ikimasu.", exampleEnglish: "I go to school." },
                { kanji: "見る", kana: "みる", romaji: "miru", english: "To see", example: "映画を見ます。", exampleRomaji: "Eiga o mimasu.", exampleEnglish: "I watch a movie." },
                { kanji: "聞く", kana: "きく", romaji: "kiku", english: "To listen", example: "音楽を聞きます。", exampleRomaji: "Ongaku o kikimasu.", exampleEnglish: "I listen to music." },
                { kanji: "友人", kana: "ゆうじん", romaji: "yuujin", english: "Friend", example: "友人に会います。", exampleRomaji: "Yuujin ni aimasu.", exampleEnglish: "I meet my friend." }
            ],
        };

        let currentCardIndex = -1;
        let previousCardIndex = -1;
        let showingMeaning = false;
        let currentSet = [];

function chooseSet(setNumber) {
    currentSet = vocabularySets[setNumber];
    document.getElementById('catalogue-container').style.display = 'none';

    // Show vocabulary preview
    const previewContainer = document.createElement('div');
    previewContainer.id = 'preview-container';
    previewContainer.style.padding = '20px';
    previewContainer.style.backgroundColor = '#ffffff';
    previewContainer.style.borderRadius = '15px';
    previewContainer.style.boxShadow = '0 8px 16px rgba(0, 0, 0, 0.2)';
    previewContainer.style.marginBottom = '20px';

    let previewHtml = '<h3>Vocabulary Preview</h3><ul>';
    currentSet.forEach(card => {
        previewHtml += `<li>${card.kanji} (${card.kana}) - ${card.english}</li>`;
    });
    previewHtml += '</ul><button class="catalogue-button" onclick="proceedToModeSelection()">Proceed to Practice</button>';
    previewContainer.innerHTML = previewHtml;

    document.body.appendChild(previewContainer);
}






function proceedToModeSelection() {
    const previewContainer = document.getElementById('preview-container');
    if (previewContainer) {
        previewContainer.remove();
    }
    document.getElementById('mode-container').style.display = 'flex';
        }

        function startFlashcardMode() {
    // Hide all other containers
    document.getElementById('mode-container').style.display = 'none';
    document.getElementById('test-container').classList.remove('show');
    document.getElementById('matching-container').style.display = 'none';
    document.getElementById('listening-container').style.display = 'none';

    // Show Flashcard Mode container
    const flashcardContainer = document.getElementById('flashcard-container');
    flashcardContainer.style.display = 'flex';
    flashcardContainer.classList.add('show');

    // Start Flashcard Mode
    nextFlashcard();
}


        function startTestMode() {
    // Hide all other containers
    document.getElementById('catalogue-container').style.display = 'none';
    document.getElementById('mode-container').style.display = 'none';
    document.getElementById('flashcard-container').classList.remove('show');
    document.getElementById('matching-container').style.display = 'none';
    document.getElementById('listening-container').style.display = 'none';

    // Reset and show Test Mode container
    const testContainer = document.getElementById('test-container');
    testContainer.style.display = 'flex'; // Ensure it is displayed
    testContainer.classList.add('show');

    // Reset variables
    currentQuestion = 0;
    correctAnswers = 0;

    // Shuffle the vocabulary set
    currentSet = shuffleArray([...currentSet]);

    // Start the first test question
    nextTestQuestion();
}



function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}



function nextFlashcard() {
    // Play card flip sound
    const cardFlipSound = document.getElementById('card-flip-sound');
    cardFlipSound.play();

    // Move to the next card in sequence
    currentCardIndex++;

    // If the index exceeds the last card, restart from the first card
    if (currentCardIndex >= currentSet.length) {
        currentCardIndex = 0;
    }

    // Reset showingMeaning and update the flashcard
    showingMeaning = false;
    updateFlashcard();

    // Hide the "Next" and "Study Again" buttons until the meaning is shown again
    document.getElementById('next-button').style.display = 'none';
    document.getElementById('study-again-button').style.display = 'none';

    // Show the "Show Meaning" button for the next word
    document.getElementById('show-meaning-button').style.display = 'inline-block';
}





function showMeaning() {
    showingMeaning = true;
    updateFlashcard();

    // Hide "Show Meaning" button once it's clicked
    document.getElementById('show-meaning-button').style.display = 'none';

    // Show the "Next" and "Study Again" buttons
    document.getElementById('next-button').style.display = 'inline-block';
    document.getElementById('study-again-button').style.display = 'inline-block';
}


function studyAgain() {
    // Add the current card back to the end of the deck
    currentSet.push(currentSet[currentCardIndex]);
    
    // Move to the next card
    currentCardIndex++;
    if (currentCardIndex >= currentSet.length) {
        currentCardIndex = 0; // Wrap around if needed
    }

    // Reset showingMeaning and update the flashcard to hide the meaning
    showingMeaning = false;
    updateFlashcard();

    // Hide the "Next" and "Study Again" buttons
    document.getElementById('study-again-button').style.display = 'none';
    document.getElementById('next-button').style.display = 'none';

    // Show the "Show Meaning" button for the next word
    document.getElementById('show-meaning-button').style.display = 'inline-block';
}



function updateFlashcard() {
            const card = currentSet[currentCardIndex];
            const flashcardElement = document.getElementById('flashcard');
            if (showingMeaning) {
                flashcardElement.innerHTML = `<span class="romaji-text">${card.romaji}</span><br><span class="kana-text">${card.kana}</span><br><span class="english-text">${card.english}</span><br><br><strong>Example:</strong><br>${card.example}${card.exampleEnglish}`;
            } else {
                flashcardElement.innerHTML = card.kanji;
            }
        }

function playAudio() {
    const card = currentSet[currentCardIndex];
    const utterance = new SpeechSynthesisUtterance(showingMeaning ? card.example : card.kana);
    utterance.lang = 'ja-JP';
    utterance.rate = 1; // Slower reading speed

    // Fetch available voices
    let voices = window.speechSynthesis.getVoices();

    // Wait until voices are loaded (sometimes they are not loaded immediately)
    if (voices.length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            voices = window.speechSynthesis.getVoices();
            setJapaneseVoice(utterance, voices);
            window.speechSynthesis.speak(utterance);
        };
    } else {
        setJapaneseVoice(utterance, voices);
        window.speechSynthesis.speak(utterance);
    }
}

function setJapaneseVoice(utterance, voices) {
    // Find the Google 日本語 voice among the available voices
    const googleJapaneseVoice = voices.find(voice => voice.name === "Google 日本語");
    
    if (googleJapaneseVoice) {
        utterance.voice = googleJapaneseVoice;
    } else {
        // Fallback: use the first Japanese voice available if Google 日本語 is not found
        const otherJapaneseVoice = voices.find(voice => voice.lang === "ja-JP");
        if (otherJapaneseVoice) {
            utterance.voice = otherJapaneseVoice;
        }
    }
}


function correctAnswer() {
    // Increment the count of correct answers
    correctAnswers++;

    // Play the correct answer sound
    const correctSound = new Audio('correct-answer-sound.mp3');
    correctSound.play();

    // Show a brief message instead of an alert
    displayMessage("Correct!", true);

    // Proceed to the next question after a short delay
    setTimeout(nextTestQuestion, 1000);
}


function nextTestQuestion() {
    // Check if we've completed all questions in the set
    if (currentQuestion >= currentSet.length) {
        // Play Pikachu sound when the test completes
        const pikachuSound = document.getElementById('pikachu-sound');
        pikachuSound.play();

        // Show completion message
        alert(`Test complete! You got ${correctAnswers}/${currentSet.length} correct.`);
        goBackToCatalogue();
        return;
    }

    // Set the current card to the next one in sequence
    currentCardIndex = currentQuestion;

    const card = currentSet[currentCardIndex];
    currentQuestion++; // Move to the next question after setting the current one

    // Update the test question text
    const testQuestionElement = document.getElementById('test-question');
    testQuestionElement.innerHTML = `(${currentQuestion}/${currentSet.length}) What is the meaning of: ${card.kanji} (${card.kana})?`;

    // Clear previous answers and generate new ones
    const answerContainer = document.getElementById('test-answers');
    answerContainer.innerHTML = '';
    const correctAnswerIndex = Math.floor(Math.random() * 4);

    for (let i = 0; i < 4; i++) {
        const button = document.createElement('button');
        button.className = 'catalogue-button';
        if (i === correctAnswerIndex) {
            button.innerHTML = card.english;
            button.onclick = () => correctAnswer();
        } else {
            let wrongAnswer;
            do {
                wrongAnswer = currentSet[Math.floor(Math.random() * currentSet.length)].english;
            } while (wrongAnswer === card.english || wrongAnswer === undefined);
            button.innerHTML = wrongAnswer;
            button.onclick = () => incorrectAnswer();
        }
        answerContainer.appendChild(button);
    }

    playTestAudio();
}



function playTestAudio() {
    const card = currentSet[currentCardIndex];
    const utterance = new SpeechSynthesisUtterance(card.kana);
    utterance.lang = 'ja-JP';
    utterance.rate = 1; // Set reading speed to be slower

    // Fetch available voices
    let voices = window.speechSynthesis.getVoices();

    // Wait until voices are loaded (sometimes they are not loaded immediately)
    if (voices.length === 0) {
        window.speechSynthesis.onvoiceschanged = () => {
            voices = window.speechSynthesis.getVoices();
            setJapaneseVoice(utterance, voices);
            window.speechSynthesis.speak(utterance);
        };
    } else {
        setJapaneseVoice(utterance, voices);
        window.speechSynthesis.speak(utterance);
    }
}

        function correctAnswer() {
    correctAnswers++;
    const audio = new Audio('correct-answer-sound.mp3');
    audio.play();
    alert('Correct!');
    nextTestQuestion();
}

function incorrectAnswer() {
    alert('Incorrect. Try again!');
}




function goBackToCatalogue() {
        // Hide all mode-specific containers
        document.getElementById('matching-container').style.display = 'none';
        document.getElementById('test-container').style.display = 'none'; 
        document.getElementById('test-container').classList.remove('show'); 
        document.getElementById('flashcard-container').classList.remove('show');
        document.getElementById('listening-container').style.display = 'none';
        document.getElementById('mode-container').style.display = 'none';
        document.getElementById('catalogue-container').style.display = 'flex';

        // Remove the preview container if it exists
        const previewContainer = document.getElementById('preview-container');
        if (previewContainer) {
            previewContainer.remove();
        }
        stopBattleBgm();
    }


    

function checkListeningAnswer(selectedAnswer, correctAnswer) {
        if (selectedAnswer === correctAnswer) {
            correctAnswers++;
            const correctSound = new Audio('correct-answer-sound.mp3');
            correctSound.play();  // Play the sound for correct answer immediately

            // Show a brief message instead of an alert
            displayMessage("Correct!", true);

            // Proceed to the next question after a short delay
            setTimeout(loadListeningQuestion, 1000);
        } else {
            // Show a brief message instead of an alert
            displayMessage("Incorrect. Try again!", false);
        }
    }

    // Function for correct answers in Test Mode
    function correctAnswer() {
        correctAnswers++;
        const correctSound = new Audio('correct-answer-sound.mp3');
        correctSound.play();  // Play the sound for correct answer immediately

        // Show a brief message instead of an alert
        displayMessage("Correct!", true);

        // Proceed to the next question after a short delay
        setTimeout(nextTestQuestion, 1000);
    }

    // Function to display a message without blocking JavaScript execution
    function displayMessage(message, isCorrect) {
        const messageElement = document.createElement('div');
        messageElement.textContent = message;
        messageElement.style.position = 'fixed';
        messageElement.style.bottom = '20px';
        messageElement.style.left = '50%';
        messageElement.style.transform = 'translateX(-50%)';
        messageElement.style.padding = '10px 20px';
        messageElement.style.backgroundColor = isCorrect ? 'black' : 'red';
        messageElement.style.color = 'white';
        messageElement.style.borderRadius = '8px';
        messageElement.style.fontSize = '1.2em';
        messageElement.style.zIndex = '1000';
        document.body.appendChild(messageElement);

        // Remove the message after 1 second
        setTimeout(() => {
            document.body.removeChild(messageElement);
        }, 1000);
    }



    function startMatchingMode() {
    // Hide other containers if they are still visible
    document.getElementById('catalogue-container').style.display = 'none';
    document.getElementById('mode-container').style.display = 'none';
    document.getElementById('test-container').classList.remove('show');
    document.getElementById('flashcard-container').classList.remove('show');
    document.getElementById('listening-container').style.display = 'none';
    document.getElementById('matching-container').style.display = 'flex';
    document.querySelector('.home-button').style.display = 'block';

    loadMatchingPairs();
}



function loadMatchingPairs() {
    const matchingGameContainer = document.getElementById('matching-game');
    matchingGameContainer.innerHTML = '';

    // Randomly select 8 pairs of words
    const selectedPairs = shuffleArray(currentSet).slice(0, 8);

    // Create an array of both Japanese and English items and shuffle it
    let items = [];
    selectedPairs.forEach(pair => {
        // Only display Kana for Japanese words
        items.push({ text: pair.kana, type: 'japanese', pairId: pair.english });
        items.push({ text: pair.english, type: 'english', pairId: pair.english });
    });
    items = shuffleArray(items);

    // Add items to the matching game container
    items.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'matching-item';
        div.textContent = item.text;
        div.dataset.pairId = item.pairId;
        div.onclick = () => handleMatchingClick(div);
        matchingGameContainer.appendChild(div);
    });
}


let selectedItems = []; // Tracks currently selected items
let debounce = false;   // Prevents rapid clicks from being processed

function handleMatchingClick(item) {
    if (debounce) return; // Ignore clicks during debounce period

    if (item.classList.contains('selected')) {
        // Deselect item if already selected
        item.classList.remove('selected');
        selectedItems = selectedItems.filter(i => i !== item);
    } else if (selectedItems.length < 2) {
        // Select item if less than 2 are selected
        item.classList.add('selected');
        selectedItems.push(item);

        // If two items are selected, check if they match
        if (selectedItems.length === 2) {
            debounce = true; // Block additional clicks
            setTimeout(() => {
                checkMatch();
                debounce = false; // Allow clicks after checking
            }, 500); // Adjust delay as needed
        }
    }
}


function checkMatch() {
    const [item1, item2] = selectedItems;

    if (item1.dataset.pairId === item2.dataset.pairId) {
        // Correct match - Remove matched items from the game immediately
        item1.classList.add('matched');
        item2.classList.add('matched');
        item1.style.visibility = 'hidden';
        item2.style.visibility = 'hidden';

        // Play correct answer sound when a pair is matched
        const correctSound = new Audio('correct-answer-sound.mp3');
        correctSound.play();

        selectedItems = [];

        // Check if all items are matched
        if (document.querySelectorAll('.matching-item:not(.matched)').length === 0) {
            const pikachuSound = document.getElementById('pikachu-sound');
            pikachuSound.play();
            // Hide the matching container and return to catalogue
            document.getElementById('matching-container').style.display = 'none';
            goBackToCatalogue();
        }
    } else {
        // Incorrect match - Deselect items after delay
        setTimeout(() => {
            item1.classList.remove('selected');
            item2.classList.remove('selected');
            selectedItems = [];
        }, 1000);
    }
}


function checkMatching() {
    if (document.querySelectorAll('.matching-item.matched').length === 16) {
        alert('You matched all the pairs correctly!');
        goBackToCatalogue();
    } else {
        alert('Some pairs are not correctly matched. Try again!');
    }
}


function resetAllContainers() 
    {
        const containers = document.querySelectorAll(
            '#flashcard-container, #test-container, #matching-container, #listening-container, #battle-container, #sprite-selection-container, #mode-container'
        );
        containers.forEach(container => {
            container.style.display = 'none'; // Hide all containers
            container.classList.remove('show'); // Reset any 'show' classes
        });

        // Remove the preview container if it exists
        const previewContainer = document.getElementById('preview-container');
        if (previewContainer) {
            previewContainer.remove();
        }

        // Show the catalogue container
        document.getElementById('catalogue-container').style.display = 'flex';

        stopBattleBgm();
    }


    let timerInterval; // To store the timer interval
    let startTime; // To record the start time of the activity

    function startMatchingMode() {
        // Hide other containers if they are still visible
        document.getElementById('catalogue-container').style.display = 'none';
        document.getElementById('mode-container').style.display = 'none';
        document.getElementById('test-container').classList.remove('show');
        document.getElementById('flashcard-container').classList.remove('show');
        document.getElementById('listening-container').style.display = 'none';
        document.getElementById('matching-container').style.display = 'flex';
        document.querySelector('.home-button').style.display = 'block';

        // Remove existing timer display if it exists
        const existingTimerDisplay = document.getElementById('timer-display');
        if (existingTimerDisplay) {
            existingTimerDisplay.remove();
        }

        // Stop any existing timer interval
        if (timerInterval) {
            clearInterval(timerInterval);
        }

        // Start a new timer
        startTimer();

        // Load matching pairs
        loadMatchingPairs();
    }

    function startTimer() {
        startTime = Date.now(); // Record the start time
        const timerDisplay = document.createElement('div');
        timerDisplay.id = 'timer-display';
        timerDisplay.style.fontSize = '0.7em';
        timerDisplay.style.marginTop = '50px';
        document.getElementById('matching-container').appendChild(timerDisplay);

        // Update the timer every second
        timerInterval = setInterval(() => {
            const elapsedTime = Date.now() - startTime;
            const seconds = Math.floor((elapsedTime / 1000) % 60);
            const minutes = Math.floor((elapsedTime / (1000 * 60)) % 60);
            timerDisplay.textContent = `Time: ${minutes} min ${seconds} sec`;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval); // Stop the timer
    }

    function checkMatch() {
        const [item1, item2] = selectedItems;

        if (item1.dataset.pairId === item2.dataset.pairId) {
            // Correct match - Remove matched items from the game immediately
            item1.classList.add('matched');
            item2.classList.add('matched');
            item1.style.visibility = 'hidden';
            item2.style.visibility = 'hidden';

            // Play correct answer sound when a pair is matched
            const correctSound = new Audio('correct-answer-sound.mp3');
            correctSound.play();

            selectedItems = [];

            // Check if all items are matched
            if (document.querySelectorAll('.matching-item:not(.matched)').length === 0) {
                stopTimer(); // Stop the timer
                const pikachuSound = document.getElementById('pikachu-sound');
                pikachuSound.play();
                // Hide the matching container and return to catalogue
                alert(`You completed the matching activity in ${document.getElementById('timer-display').textContent}.`);
                document.getElementById('matching-container').style.display = 'none';
                goBackToCatalogue();
            }
        } else {
            // Incorrect match - Deselect items after delay
            setTimeout(() => {
                item1.classList.remove('selected');
                item2.classList.remove('selected');
                selectedItems = [];
            }, 1000);
        }
    }



function chooseSet(setNumber) {
    currentSet = vocabularySets[setNumber];
    document.getElementById('catalogue-container').style.display = 'none';

    // Show vocabulary preview
    const previewContainer = document.createElement('div');
    previewContainer.id = 'preview-container';
    previewContainer.style.padding = '20px';
    previewContainer.style.backgroundColor = '#ffffff';
    previewContainer.style.borderRadius = '15px';
    previewContainer.style.boxShadow = '0 8px 16px rgba(0, 0, 0, 0.2)';
    previewContainer.style.marginBottom = '20px';

    let previewHtml = '<h3>Vocabulary Preview</h3><ul>';
    currentSet.forEach(card => {
        previewHtml += `<li>${card.kanji} (${card.kana}) - ${card.english}</li>`;
    });
    previewHtml += '</ul><button class="catalogue-button" onclick="proceedToModeSelection()">Proceed to Practice</button>';
    previewContainer.innerHTML = previewHtml;

    document.body.appendChild(previewContainer);
}

function startBattleMode() {
    if (currentSet.length === 0) {
        alert('Please select a vocabulary set first!');
        return;
    }

    // Show sprite selection screen
    document.getElementById('mode-container').style.display = 'none';
    document.getElementById('sprite-selection-container').style.display = 'flex';

    // Show 3 random sprites to the user to choose from
    const availableSprites = document.getElementById('available-sprites');
    availableSprites.innerHTML = '';  // Clear previous sprites
    const randomSprites = shuffleArray([...userSprites]).slice(0, 3);

    randomSprites.forEach((sprite, index) => {
        const img = document.createElement('img');
        img.src = sprite;
        img.className = 'sprite-image';
        img.style.cursor = 'pointer';
        img.onclick = () => selectUserSprite(sprite);
        availableSprites.appendChild(img);
    });
}

let selectedUserSprite = '';

function selectUserSprite(sprite) {
    // Set the selected user sprite and start the battle
    selectedUserSprite = sprite;

    // Hide sprite selection screen and show battle container
    document.getElementById('sprite-selection-container').style.display = 'none';
    document.getElementById('battle-container').style.display = 'flex';

    // Set the selected sprite for the user's boxer
    const userBoxerImg = document.getElementById('user-boxer').querySelector('img');
    userBoxerImg.src = selectedUserSprite;

    // Set a random sprite for the NPC each time
    const npcBoxerImg = document.getElementById('npc-boxer').querySelector('img');
    const randomNpcSpriteIndex = Math.floor(Math.random() * npcSprites.length);
    npcBoxerImg.src = npcSprites[randomNpcSpriteIndex];

    // Play a random BGM
    const battleBgm = document.getElementById('battle-bgm');
    const randomBgmIndex = Math.floor(Math.random() * battleBgms.length);
    battleBgm.src = battleBgms[randomBgmIndex];
    battleBgm.play();

    // Reset HP bars
    document.getElementById('user-hp').style.width = '100%';
    document.getElementById('npc-hp').style.width = '100%';
    currentQuestion = 0;
    correctAnswers = 0;

    // Start the first question
    nextBattleQuestion();
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}



function nextBattleQuestion() {
    // Only proceed if the battle hasn't ended
    const npcHP = parseFloat(document.getElementById('npc-hp').style.width);
    const userHP = parseFloat(document.getElementById('user-hp').style.width);

    if (npcHP <= 0 || userHP <= 0) {
        return; // Don't continue if battle is already over
    }

    currentQuestion++;
    const card = currentSet[Math.floor(Math.random() * currentSet.length)];
    const correctAnswer = card.english;

    let answers = [correctAnswer];
    while (answers.length < 4) {
        const randomAnswer = currentSet[Math.floor(Math.random() * currentSet.length)].english;
        if (!answers.includes(randomAnswer)) {
            answers.push(randomAnswer);
        }
    }
    answers = answers.sort(() => Math.random() - 0.5);

    document.getElementById('battle-question').textContent = `What is the meaning of: ${card.kanji} (${card.kana})?`;
    const answersContainer = document.getElementById('battle-answers');
    answersContainer.innerHTML = '';

    answers.forEach(answer => {
        const button = document.createElement('button');
        button.textContent = answer;
        button.onclick = () => checkBattleAnswer(answer, correctAnswer);
        button.className = 'catalogue-button'; // Add button styles
        answersContainer.appendChild(button);
    });
}

function checkBattleAnswer(selectedAnswer, correctAnswer) {
    const npcHP = document.getElementById('npc-hp');
    const userHP = document.getElementById('user-hp');
    const userBoxer = document.getElementById('user-boxer');
    const npcBoxer = document.getElementById('npc-boxer');
    const stage = document.querySelector('.stage');

    if (selectedAnswer === correctAnswer) {
        // User lands a punch
        correctAnswers++;
        let npcCurrentHP = parseFloat(npcHP.style.width) || 100;
        npcCurrentHP = Math.max(0, npcCurrentHP - 5);
        npcHP.style.width = npcCurrentHP + '%';

        // Animate NPC hit
        npcBoxer.querySelector('img').style.transform = 'translateX(20px)';
        setTimeout(() => npcBoxer.querySelector('img').style.transform = 'translateX(0)', 200);

        const tackleSound = document.getElementById('tackle-sound');
        tackleSound.play();

    } else {
        // NPC counters - User loses HP
        let userCurrentHP = parseFloat(userHP.style.width) || 100;
        userCurrentHP = Math.max(0, userCurrentHP - 20);
        userHP.style.width = userCurrentHP + '%';

        // Animate User hit
        userBoxer.querySelector('img').style.transform = 'translateX(-20px)';
        setTimeout(() => userBoxer.querySelector('img').style.transform = 'translateX(0)', 200);

        // Play Tackle Sound Effect
        const tackleSound = document.getElementById('tackle-sound');
        tackleSound.play();

        // Turn stage red for 1 second
        const originalBackground = stage.style.background || stage.style.backgroundColor || '';
        stage.style.background = 'red';
        setTimeout(() => {
            stage.style.background = originalBackground;
        }, 1000);
    }

    // Convert HP values to float to accurately check the HP left
    const npcRemainingHP = parseFloat(npcHP.style.width);
    const userRemainingHP = parseFloat(userHP.style.width);

    // Check if the battle should end
    if (npcRemainingHP <= 0) {
        endBattle('win');
    } else if (userRemainingHP <= 0) {
        endBattle('lose');
    } else {
        // Only proceed to the next question if the battle has not ended
        nextBattleQuestion();
    }
}

function endBattle(result) {
    // Stop the background music
    stopBattleBgm();

    // Play victory or defeat sound
    if (result === 'win') {
        const victorySound = document.getElementById('victory-sound');
        victorySound.play();
        alert('You won! You have defeated the opponent!');
    } else if (result === 'lose') {
        alert('(┬┬﹏┬┬) You lose! Try again!');
    }

    // Automatically transition to catalogue/home page after alert
    setTimeout(() => {
        document.getElementById('battle-container').style.display = 'none';
        document.getElementById('catalogue-container').style.display = 'flex';
    }, 200); // Delay to allow the alert message to finish
}


function stopBattleBgm() {
    const battleBgm = document.getElementById('battle-bgm');
    if (battleBgm) {
        battleBgm.pause();
        battleBgm.currentTime = 0; // Reset to the beginning
    }
}

// Array of different user sprite image URLs
const userSprites = [
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__384-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__006-mega-y__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__003-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__257-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__373-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__663__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__666-ocean__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__714__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__181-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__282-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__254-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__382-primal__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__115-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__127-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__130-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__142-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__018-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__065-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__150-mega-y__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__381-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_156.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_642-therian__2.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_250.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_049.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_017.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_119_m.gif',
    'https://media.tenor.com/4K2_dLLq-pwAAAAi/charmander-chases-tail.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_212_f.gif',
    'https://www.pokencyclopedia.info/sprites/gen5/ani-b_black-white/a-b_bw_249.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__663__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__666--fancy__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__697__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__208-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__800-ultra__uu.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__785__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__774-red__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__743__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__738__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__732__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__764__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__746-school__sm.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/blastoise-gigantamax.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__720-unbound__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__719-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__670--eternal__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__334-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__009-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__229-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__686__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6/3a-b__679__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6_shiny/3a-b_-S_717__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6_shiny/3a-b_-S_693__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6_shiny/3a-b_-S_248-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6_shiny/3a-b_-S_181-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_6_shiny/3a-b_-S_015-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__303-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__026-alola__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__103-alola__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__028-alola__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__730__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__787__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__804__uu.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__105-alola__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__727__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__089-alola__sm.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani-b_7/3a-b__658-ash__sm.gif',

    

    // Add as many sprite URLs as you like!
];


const npcSprites = [
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/pikachu-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/snorlax-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/meowth-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/drednaw-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/corviknight-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/venusaur-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/machamp-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/charizard-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/mr.-mime-galar.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/darmanitan-galar-zen.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/dragapult.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/zarude-dada.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/centiskorch-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-shiny-sprites/toxtricity-gigantamax.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/flapple.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/corviknight.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/scorbunny.gif',
    'https://projectpokemon.org/images/sprites-models/swsh-normal-sprites/rillaboom.gif',
    'https://www.rebornevo.com/uploads/monthly_2023_05/valiant.gif.1efdebc6c6235323121f8f075d2a00f0.gif',
    'https://www.rebornevo.com/uploads/monthly_2023_05/valiant.gif.1efdebc6c6235323121f8f075d2a00f0.gif',
    'https://forums.pokemmo.com/uploads/monthly_2022_11/1-front-n.gif.c74d2b040bee6a2e5e6710e93ab7e62e.gif',
    'https://forums.pokemmo.com/uploads/monthly_2022_11/1-front-n.gif.c74d2b040bee6a2e5e6710e93ab7e62e.gif',
    'https://www.smogon.com/forums/attachments/gholdengo_by_senso88_dfpqhhv-gif.528125/',
    'https://www.smogon.com/forums/attachments/klawf_by_senso88_dfprib6-gif.528126/',
    'https://wikimon.net/images/2/2e/162_KaratsukiNumemon.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__009-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__127-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__383-primal__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__384-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__445-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__666--fancy__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__660__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__334-mega__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__142-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__130-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__006-mega-y__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__006-mega-x__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__003-mega__xy.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__025-pop-star__oras.gif',
    'https://www.pokencyclopedia.info/sprites/3ds/ani_6/3ani__025-rock-star__oras.gif',



    // Add more sprites if you'd like!
];

const battleBgms = [
    'pokebgm1.mp3',
    'pokebgm2.mp3',  // Replace with your own track names or paths
    'pokebgm3.mp3'   // Add as many tracks as you want!
];

    </script>


</body></html>